
## ✅ 基本方針（非エンジニアでも安心して使える開発支援）

- 「壊れない」「予期しない変更をしない」を最優先とする
- 既存の動作・見た目・機能を**勝手に変更しないこと**
- 変更が必要な場合は、必ず事前に理由と内容を説明して**承認を得ること**
- 段階的・安全な修正を心がける（一度に大きな変更をしない）

---

## 🔍 プロジェクト構造の自動点検義務

このファイルを読み込んだ際は、AI自身が以下の点検を行う：
- プロジェクトのディレクトリ構造・ファイル設計を見直す
- 冗長・無駄・不整合がないか確認し、**段階的な提案**を行う
- 改善が必要な場合は、以下の手順を踏む

### ✅ 改善ステップ
1. **現状分析とヒアリング**
   - プロジェクトの構造・使用技術を分析
   - ユーザーにヒアリングし、優先順位・今後の展望・制約を明確化
2. **改善計画の策定**
   - ステップごとに開発・修正計画を提示
   - 各案についてメリット・デメリット・リスクを記載
   - **バックアップ戦略**を明記
3. **制御ルールファイルの提案・生成**
   - 必要に応じて、`nextjs.mdc`、`techstack.mdc` などを提案・生成
   - 配置は `.cursor/rules/dev-rules/` 以下に限定する
4. **段階的実行と検証**
   - 小さな単位で安全に修正
   - 各ステップでビルド・動作確認を行う
   - 問題があれば、**直近のバックアップから即座に復元**

---

## ⚠️ 推奨事項：壊さない修正を行うための前提

1. 修正前にバックアップを作成
2. 修正を実行
3. ビルド・動作を確認
4. 失敗時は自動的に直前の状態に復元
5. 成功時のみ次へ進む

この手順を厳守すること。

---

## 🔐 守るべきルール（特に重要）
- 既存UI/UXのレイアウトや設計を**勝手に変更しないこと**
- 実装の提案は「**理由**」「**対象ファイル**」を明示すること
- 既存コードの再利用を優先する（重複機能は作らない）
- 実装内容が大きく変わる場合は、**ユーザーの許可を取ること**

---

## 🧩 適正化とフォルダ構造の最適化ルール

- このファイルを読み込むたび、プロジェクト全体の構成を見直すこと
- 不明点や設計ミスがある場合：
   1. ユーザーヒアリング
   2. 改善ステップ（上記に準拠）
   3. `.mdc` ルールファイルの整理・生成（必要に応じて `.override.mdc` で調整）

---

## 📌 重要補足
- このファイルは「共通テンプレート」として設計されています
- 特定プロジェクト用に調整が必要な場合は、`coding-rules.override.mdc` を作成して調整してください

---

## 🛡️ 保護対象ファイル・機能（変更不可・変更時は必ず相談）

### ⚠️ 最重要：動画分析機能（核となる機能）
**動画分析機能は核となる機能のため、以下のファイルは変更不可です。変更が必要な場合は必ず事前に相談してください。**

#### バックエンド
- `server/videoProcessor.ts` - 動画処理のメインロジック（ダウンロード、文字起こし、フレーム抽出、映像分析）
- `server/routers.ts` - `video.analyze` エンドポイント（210行目付近）
- `server/db.ts` - `createVideoAnalysis`, `updateVideoAnalysis` 関数

#### フロントエンド
- `client/src/pages/Analysis.tsx` - 動画分析UI（入力フォーム、結果表示）

#### データベース
- `drizzle/schema.ts` - `videoAnalyses` テーブル定義

#### ドキュメント
- `VIDEO_ANALYSIS_DEEP_DIVE.md` - 動画分析機能の詳細技術ドキュメント

### 変更時のルール
1. **これらのファイルを変更する場合は、必ず事前に理由と内容を説明し、承認を得ること**
2. **変更前には必ずバックアップを作成すること**
3. **変更後は必ず動作確認を行うこと**
4. **問題が発生した場合は、即座にバックアップから復元すること**

---
